---
const { siteTitle = 'Whono' } = Astro.props;

const pathname = Astro.url.pathname;
const base = import.meta.env.BASE_URL ?? '/';
const baseNormalized = base.endsWith('/') ? base : `${base}/`;
const withBase = (path: string) => {
  if (!path || path === '/') return baseNormalized;
  const clean = path.startsWith('/') ? path.slice(1) : path;
  return `${baseNormalized}${clean}`;
};
const homeHref = withBase('/');

const nav = [
  { label: '随笔', href: withBase('/essay/') },
  { label: '絮语', href: withBase('/bits/') },
  { label: '小记', href: withBase('/memo/') },
  { label: '归档', href: withBase('/archive/') },
  { label: '关于', href: withBase('/about/') }
];

const quote = 'A minimal Astro theme\nfor essays, notes, and docs.\nDesigned for reading,\nopen-source.';
---

<aside class="sidebar">
  <a class="sidebar__title" href={homeHref} aria-label={`${siteTitle} 首页`}>{siteTitle}</a>

  <div class="sidebar__quote">
    {quote.split('\n').map((line) => (
      <>
        {line}<br />
      </>
    ))}
  </div>

  <ul class="nav">
    {nav.map((item) => {
      const isActive = pathname === item.href || (item.href !== homeHref && pathname.startsWith(item.href));
      return (
        <li>
          <a href={item.href} aria-current={isActive ? 'page' : undefined}>
            <span>{item.label}</span>
            <span class="dot" aria-hidden="true"></span>
          </a>
        </li>
      );
    })}
  </ul>

  <div class="sidebar-actions">
    <button
      id="reader-toggle"
      class="icon-button reader-toggle"
      type="button"
      aria-label="阅读模式"
      aria-pressed="false"
      title="阅读模式"
    >
      <svg class="icon icon-book-open" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path
          d="M12 6c-2-1.3-4.5-2-7-2v14c2.5 0 5 .7 7 2"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M12 6c2-1.3 4.5-2 7-2v14c-2.5 0-5 .7-7 2"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M12 6.5V17.5"
          fill="none"
          stroke="currentColor"
          stroke-width="1.4"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <svg class="icon icon-book-closed" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path
          d="M7 4.5h9a2.5 2.5 0 0 1 2.5 2.5V19"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M7 19V4.5M7 19h9"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
        <path
          d="M12 6.5V17.5"
          fill="none"
          stroke="currentColor"
          stroke-width="1.4"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </button>

    <a class="icon-button rss-link" href={withBase('/archive/rss.xml')} aria-label="RSS 订阅" title="RSS 订阅">
      <svg class="icon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <circle cx="6" cy="18" r="1.8" fill="currentColor" />
        <path
          d="M4 11a9 9 0 0 1 9 9"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
        <path
          d="M4 5a15 15 0 0 1 15 15"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
      </svg>
    </a>

    <button
      id="theme-toggle"
      class="icon-button theme-toggle"
      type="button"
      aria-label="夜间模式"
      aria-pressed="false"
      title="夜间模式"
    >
      <svg class="icon icon-moon" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <path
          d="M21 12.79A9 9 0 1 1 11.21 3a7 7 0 0 0 9.79 9.79z"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
      <svg class="icon icon-sun" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
        <circle
          cx="12"
          cy="12"
          r="4.2"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
        />
        <path
          d="M12 2.5v2.5M12 19v2.5M4.2 4.2l1.8 1.8M18 18l1.8 1.8M2.5 12h2.5M19 12h2.5M4.2 19.8l1.8-1.8M18 6l1.8-1.8"
          fill="none"
          stroke="currentColor"
          stroke-width="1.6"
          stroke-linecap="round"
        />
      </svg>
    </button>
  </div>
</aside>

